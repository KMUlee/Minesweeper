<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>2048</title>
    <style>
        * { padding: 0; margin: 0}
        canvas {background: white; display: block; margin: 0 auto}
    </style>
</head>
<body>
<canvas id="canv" width="410" height="410"></canvas>
<script>
    var canvas = document.getElementById("canv");
    var ctx = canvas.getContext("2d");
    var start = true;
    var nums = [2, 4];

    var key_map = [-1,[0,-1], [1,0], [0,1], [-1,0]];
    var key_num = 0;
    var map = [];
    var rand = Math.floor(Math.random()*16);
    var rn = Math.floor(Math.random()*2);
    var temp = 0;
    for (i = 0; i < 4; i++){
        map[i] = [];
        for (j = 0; j < 4; j++){
            map[i][j] = { x: j, y: i, n: 0};
            if (temp == rand){
                map[i][j].n = 2;
            }
            temp++;
        }
    }

    document.addEventListener("keydown", keyDownHandler, false);

    function keyDownHandler(e) {
        if (e.keyCode == 37){
            //left
            key_num = 1;
        }
        else if (e.keyCode == 38){
            //up
            key_num = 2;
        }
        else if (e.keyCode == 39){
            //right
            key_num = 3;
        }
        else if (e.keyCode == 40){
            //down
            key_num = 4;
        }
    }

    function make_map() {
        while (true){
            temp = rand;
            rand = Math.floor(Math.random()*16);
            if (temp != rand) {
                break;
            }
        }
        rn = Math.floor(Math.random()*2);
        temp = 0;
        for (i = 0; i < 4; i++){
            for (j = 0; j < 4; j++){
                var m = map[i][j];
                if (temp == rand) {
                    if (start) {
                        m.n = nums[0];
                        continue;
                    }
                    m.n = num[rn];
                }
                temp++;
                console.log(map[i][j].n);
            }
        }
    }

    function draw_main() {
        ctx.beginPath();
        for (i = 0; i < 5; i++){
            ctx.rect(i*102, 0, 2, canvas.height);
        }
        for (i = 0; i < 5; i++){
            ctx.rect(0, i*102, canvas.width, 2);
        }
        ctx.fillStyle = "black";
        ctx.fill();
        ctx.closePath();
    }
    make_map();
    draw_main();
</script>
</body>
</html>